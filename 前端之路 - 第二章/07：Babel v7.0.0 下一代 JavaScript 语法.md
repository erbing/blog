# ç¬¬äºŒç«  - 07ï¼šBabel ä¸‹ä¸€ä»£ JavaScript è¯­æ³•ç¼–è¯‘å™¨

> å†™æœ¬ç« çš„å†…å®¹çš„å‡ºå‘ç‚¹ä¸»è¦æ˜¯ ä¸ºäº†å¯¹äºä¹‹å‰å…³äº JS ç‰ˆæœ¬çš„ä¸€ä¸ªæ€»ç»“ï¼Œåœ¨ä¹‹å‰çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å§‹ç»ˆå¯¹äº ECMAScript çš„ç‰ˆæœ¬çš„æ›´æ–°ä¸å¤Ÿé‡è§†ï¼Œä»¥è‡³äºåœ¨åé¢çš„ å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å§‹ç»ˆä¼šè¢«å„ç§æ–°å¥‡çš„è¯­æ³•æ‰“æ–­äº†æˆ‘ä»¬çš„æ€è€ƒæ€è·¯ï¼Œæ‰€ä»¥å¯¹äºåŸºç¡€çš„è¿½æ±‚ï¼Œæ˜¯ä»»ä½•æ—¶å€™éƒ½ä¸èƒ½å¿˜è®°çš„ã€‚ä¸ç„¶ä¼šçš„æ¡†æ¶å†å¤šï¼Œä¼šç©å„¿çš„èŠ±æ ·å†å¤šï¼Œåˆ°å¤´æ¥éƒ½åªæ˜¯ API ã€‚

> å¦å¤– ä¸€ä¸ªç›®çš„å°±æ˜¯æƒ³åšä¸€ä¸ªå¥½ç©çš„ä¸œè¥¿ï¼Œå°±æ˜¯ å®æ—¶ç¼–è¯‘æ‰€å†™çš„é«˜ç‰ˆæœ¬ï¼ˆES2015+ï¼‰çš„ JS ä»£ç ã€‚è½¬åŒ–æˆç°åœ¨å¤§éƒ¨åˆ†æµè§ˆå™¨å¯ä»¥å…¼å®¹çš„ ES5 ã€ ES3 ç­‰ã€‚

> ä¸‹é¢å°±æ­£å¼ä»‹ç»ä¸‹ Babel ï¼ˆv7.0.0 ï¼‰

## ä¸€ã€ä»€ä¹ˆæ˜¯ Babel

> Babel æ˜¯ä¸€ä¸ª JavaScript ç¼–è¯‘å™¨ï¼ŒBabel é€šè¿‡è¯­æ³•å˜æ¢å™¨æ”¯æŒæœ€æ–°ç‰ˆæœ¬çš„ JavaScriptã€‚

### 1-1 ä½¿ç”¨æ–¹æ³•ï¼š

> Babel å·¥å…·é“¾ä¸­æœ‰å¾ˆå¤šå·¥å…·å¯ä»¥è®©ä½ è½»æ¾ä½¿ç”¨ Babelï¼Œæ— è®ºä½ æ˜¯â€œç»ˆç«¯ç”¨æˆ·â€è¿˜æ˜¯æ„å»ºä¸­é›†æˆ Babelã€‚æœ¬æ–‡æ˜¯å¿«é€Ÿä½¿ç”¨è¿™äº›å·¥å…·çš„æŒ‡å—ï¼Œä½ å¯ä»¥åœ¨æ–‡æ¡£çš„â€œç”¨æ³•â€éƒ¨åˆ†ä¸­é˜…è¯»æœ‰å…³å®ƒä»¬çš„æ›´å¤šä¿¡æ¯ã€‚

### 1-1-1 ï¼š CLI ç”¨æ³•

> è¿™é‡Œä»‹ç»åˆ°çš„ cli çš„ç”¨æ³•å…¶å®å¯¹äºå¤§éƒ¨åˆ†åŒå­¦æ¥è¯´ä¸æ˜¯å¸¸è§„ç”¨æ³•ã€‚
> å› ä¸ºè¿™ç§ç”¨æ³•å¾€å¾€å‡ºç°åœ¨ å„ç§ npm çš„åŒ…ã€cli æ„å»ºå·¥å…·é›†æˆå½“ä¸­ï¼Œæ‰€ä»¥è¿™é‡Œï¼Œæˆ‘ä»¬åªä»‹ç»ä¸‹å®ƒçš„æ ¸å¿ƒç”¨æ³•ã€‚

    ä¸‹è½½æ ¸å¿ƒåŒ…  @babel/core

```powershell
npm install --save-dev @babel/core
```

    ä½ å¯ä»¥ç›´æ¥åœ¨ JavaScript ä¸­ require å®ƒå¹¶åƒä¸‹é¢è¿™æ ·ä½¿ç”¨å®ƒ

```javascript
const babel = require("@babel/core");

babel.transform("code", optionsObject);
```

> ä½œä¸ºç»ˆç«¯ç”¨æˆ·ï¼Œä½ å¯èƒ½å¸Œæœ›å®‰è£…å…¶ä»–å·¥å…·ä½œä¸º @babel/core çš„æ¥å£ï¼Œå¹¶èƒ½å¾ˆå¥½åœ°é›†æˆåœ¨ä½ çš„å¼€å‘è¿‡ç¨‹ä¸­ã€‚å³ä¾¿å¦‚æ­¤ï¼Œä½ ä»å¯èƒ½éœ€è¦æŸ¥çœ‹å…¶æ–‡æ¡£é¡µé¢ä»¥äº†è§£è¿™äº›é€‰é¡¹ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†é€‰é¡¹ä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–å·¥å…·è¿›è¡Œè®¾ç½®ã€‚

### 1-1-2 ï¼šPlugins & Presets ç”¨æ³•

> ä»¥æ’ä»¶ å’Œ é¢„å¤„ç† çš„æ–¹å¼ï¼Œæ˜¯æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ›´ä¸ºå¸¸è§çš„æ–¹å¼ã€‚
> é€šå¸¸æˆ‘ä»¬åœ¨ Vue é¡¹ç›®å¼€å‘ä¸­ä½¿ç”¨çš„æ˜¯ Plugins çš„æ–¹å¼
> åœ¨ React é¡¹ç›®å¼€å‘ä¸­ä½¿ç”¨çš„æ˜¯ Presets çš„æ–¹å¼ ä¸‹é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥ä»‹ç» å¦‚ä½•æ¥ä½¿ç”¨ã€‚

### 1-1-3 ï¼šPolyfill

> @babel/polyfill æ¨¡å—åŒ…æ‹¬ core-js å’Œè‡ªå®šä¹‰ regenerator runtime æ¥æ¨¡æ‹Ÿå®Œæ•´çš„ ES2015+ ç¯å¢ƒã€‚
> åˆ©ç”¨ Polyfill æ›´å¤šçš„æ˜¯æ¥è§£å†³ä¸€ä¸ª æµè§ˆå™¨çš„å…¼å®¹ é«˜ç‰ˆæœ¬çš„ ES é—®é¢˜ã€‚ä½†æ˜¯å¾€å¾€å› ä¸ºè¿™ä¸ªåŒ…æ¯”è¾ƒçš„å¤§ï¼Œæ‰€ä»¥è¿˜æ˜¯æ…é‡ä½¿ç”¨ã€‚

## äºŒã€ Reactã€Vue ç»“åˆ Babel

> å¦‚ä½•åœ¨ Reactã€Vue é¡¹ç›®ä¸­ç»“åˆ Webpack ä½¿ç”¨ Babel

### 2-1 ã€React && Babel

> ä¸Šæ–‡ä¸­æœ‰ä»‹ç»åˆ° babel é…åˆ React ç­‰ä½¿ç”¨æ–¹æ³•ã€‚--- Presetsã€‚
> é¢„å¤„ç†æ–¹æ¡ˆã€‚

### 2-1-1: å¦‚ä½•ä½¿ç”¨

> æˆ‘ä»¬é…ç½®å®Œ webpack å’Œ React ï¼Œå¹¶å¯åŠ¨ serverã€‚
> è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çœ‹ä¸‹æˆ‘ä»¬ react çš„ä»£ç 

```javascript
import React from "react";
import ReactDom from "react-dom";

const App = () => {
  return (
    <div>
      <h2>hhhh</h2>
    </div>
  );
};
ReactDom.render(<App />, document.getElementById("apps"));
```

è¿™æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ react çš„ demo ä»£ç å±•ç¤ºï¼š

ç»“æœæˆ‘ä»¬å‘ç°ï¼Œæˆ‘ä»¬çš„ç»ˆç«¯ ä¸Šæ˜¾ç¤º ERROR:

```javascript
ERROR in ./src/index.js 6:4
Module parse failed: Unexpected token (6:4)
You may need an appropriate loader to handle this file type.
| const App = () => {
|   return (
>     <div>
|       <h2>hhhh</h2>
|     </div>
 @ multi (webpack)-dev-server/client?http://localhost:8081 (webpack)/hot/dev-server.js ./src main[2]
```

> TIPS: è¿™ä¸ªæ—¶å€™å¤§å¤šæ•°äººçœ‹åˆ°è¿™ä¸ª error çš„æ—¶å€™å…¶å®éƒ½æ˜¯æ‡µé€¼çš„ï¼Œç‰¹åˆ«å¯¹äºæ–°æ‰‹åˆ°è®²ï¼Œç„¶åä¸€éƒ¨åˆ†æœºæ™ºçš„å°ä¼™å­å‘ç° å·²ç»è¶…è¿‡äº†è‡ªå·±çš„ çŸ¥è¯†èŒƒå›´äº†ï¼Œå°±å» è°·æ­Œã€ç™¾åº¦å»å¯»æ±‚å¸®åŠ©

> ä¸å‡ºæ„å¤–ï¼Œæœç´¢å¼•æ“ç»Ÿä¸€ç»™å‡ºçš„ç­”æ¡ˆå°±æ˜¯ æœªé…ç½® babel çš„é¢„å¤„ç†ï¼Œå¯¼è‡´ webpack æ— æ³•è¯»æ‡‚è¿™ä¸ªä»£ç æ˜¯ä»€ä¹ˆæ„æ€ã€‚

> è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬æ¥è¯•ç€é…ç½®ä¸‹æˆ‘ä»¬çš„ babel çš„ presets. ä½†æ˜¯å¦‚ä½•é…ç½®å‘¢ï¼Ÿ
> ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯ç®€å•çš„ä»‹ç»äº†ä¸‹ï¼Œä½†æ˜¯å®é™…é…ç½®çš„æ–‡ä»¶åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿ

#### 2-1-1-1 babel é…ç½®çš„ç¬¬ä¸€ç§é…ç½®æ–¹å¼ï¼š

> æ ¹ç›®å½•åˆ›å»º `babel.config.js` æ–‡ä»¶ã€‚

```javascript
module.exports = function() {
  const presets = [];
  const plugins = [];
  return {
    presets,
    plugins
  };
};
```

babel.config.js çš„å®˜æ–¹æ–‡æ¡£åœ¨è¿™é‡Œ [babel](https://babel.docschina.org/docs/en/config-files#project-wide-configuration)

#### 2-1-1-2 babel é…ç½®çš„ç¬¬äºŒç§é…ç½®æ–¹å¼ï¼š

> æ ¹ç›®å½•åˆ›å»º `.babelrc` æ–‡ä»¶ ( JSON æ ¼å¼)ã€‚

```json
{
  "presets": [],
  "plugins": [],
  "env": {}
}
```

#### 2-1-1-3 ä¸¤ç§é…ç½®æ–¹å¼çš„æ–¹å¼éƒ½æ˜¯å¤§åŒå°å¼‚ ä¸»è¦æ˜¯é…ç½®çš„å†…å®¹

> ä¸‹ä¸€ä¸ªå°èŠ‚æˆ‘ä»¬å°±è¯¦ç»†ä»‹ç»ä¸‹ babel çš„`plugins`å’Œ`presets`è§£æ

### 2-1-2: babel çš„`plugins`å’Œ`presets`è§£æ

#### 2-1-2-1ï¼šæ˜ç¡® ES201x å’Œ ESx çš„å…³ç³»

> ES2015 =ã€‹ ES6
> ES2016 =ã€‹ ES7
> ES2017 =ã€‹ ES8

åœ¨ 2015 å¹´ä¹‹å‰ ES3 æ˜¯ä¸»æµã€‚

#### 2-1-2-2ï¼šplugin

> : babel çš„`æ’ä»¶`ï¼Œåœ¨ 6.x ç‰ˆæœ¬ä¹‹å babel`å¿…éœ€è¦`é…åˆæ’ä»¶æ¥è¿›è¡Œå·¥ä½œ

```json
{
  "plugins": ["transform-es2015-arrow-functions"]
}
```

é¡¾åæ€ä¹‰ï¼Œ è¿™ä¸ªæ’ä»¶å°±æ˜¯ä¸ºäº†ç¼–è¯‘ es6 çš„ç®­å¤´å‡½æ•°

#### 2-1-2-3ï¼špreset

> : babel`æ’ä»¶é›†åˆçš„é¢„è®¾`ï¼ŒåŒ…å«æŸä¸€éƒ¨åˆ†çš„æ’ä»¶ plugin

```json
{
  "presets": ["es2015"]
}
```

> è¿™é‡Œç€é‡è§£é‡Šä¸‹ `presets` ä¸­ `es2015` æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

> es2015 => babel-preset-es2015 (å¯ä»¥å°† es6 çš„ JS ä»£ç ç¼–è¯‘ä¸º es5)
> es2016 => babel-preset-es2016 (å¯ä»¥å°† es7 çš„ JS ä»£ç ç¼–è¯‘ä¸º es6)
> es2017 => babel-preset-es2017 (å¯ä»¥å°† es8 çš„ JS ä»£ç ç¼–è¯‘ä¸º es7)
> stage-x => babel-preset-stage-x (å¯ä»¥å°†å¤„äºæŸä¸€é˜¶æ®µçš„ js è¯­æ³•ç¼–è¯‘ä¸ºæ­£å¼ç‰ˆæœ¬çš„ js ä»£ç )

> è¿™é‡Œå†ä»‹ç»ä¸‹ stage-xï¼Œ ææ¡ˆå…±åˆ†ä¸ºäº”ä¸ªé˜¶æ®µï¼š

- stage-0: ç¨»è‰äºº-åªæ˜¯ä¸€ä¸ªå¤§èƒ†çš„æƒ³æ³•
- stage-1: ææ¡ˆ-åˆæ­¥å°è¯•
- stage-2: åˆç¨¿-å®Œæˆåˆæ­¥è§„èŒƒ
- stage-3: å€™é€‰-å®Œæˆè§„èŒƒå’Œæµè§ˆå™¨åˆæ­¥å®ç°
- stage-4: å®Œæˆ-å°†è¢«æ·»åŠ åˆ°ä¸‹ä¸€å¹´å‘å¸ƒ

#### 2-1-2-4ï¼špreset env

> å½“å‰ babel æ¨èä½¿ç”¨ `babel-preset-env` æ›¿ä»£ babel-preset-es2015 å’Œ babel-preset-es2016 ä»¥åŠ babel-preset-es2017 ,`envçš„æ”¯æŒèŒƒå›´æ›´å¹¿`ï¼ŒåŒ…å« es2015 es2016 es2017 çš„`æ‰€æœ‰è¯­æ³•ç¼–è¯‘`ï¼Œå¹¶ä¸”å®ƒå¯ä»¥æ ¹æ®é¡¹ç›®è¿è¡Œå¹³å°çš„æ”¯æŒæƒ…å†µ`è‡ªè¡Œé€‰æ‹©ç¼–è¯‘ç‰ˆæœ¬`ã€‚

ä½¿ç”¨æ–¹æ³•ï¼š

```json
{
  "presets": ["env", "stage-2"]
}
```

#### 2-1-2-5ï¼š æ’ä»¶ä¸­æ¯ä¸ªè®¿é—®è€…éƒ½æœ‰æ’åºé—®é¢˜

> è¿™æ„å‘³ç€å¦‚æœä¸¤æ¬¡è½¬è¯‘éƒ½è®¿é—®ç›¸åŒçš„â€ç¨‹åºâ€èŠ‚ç‚¹ï¼Œåˆ™è½¬è¯‘å°†æŒ‰ç…§ plugin æˆ– preset çš„è§„åˆ™è¿›è¡Œæ’åºç„¶åæ‰§è¡Œã€‚

- Plugin ä¼šè¿è¡Œåœ¨ Preset ä¹‹å‰ã€‚
- Plugin ä¼šä»ç¬¬ä¸€ä¸ªå¼€å§‹é¡ºåºæ‰§è¡Œã€‚ordering is first to last.
- Preset çš„é¡ºåºåˆ™åˆšå¥½ç›¸å(ä»æœ€åä¸€ä¸ªé€†åºæ‰§è¡Œ)ã€‚

#### 2-1-2-6: æ€»ç»“ï¼š

> ä¸Šé¢é¡¹ç›®çš„è·‘èµ·æ¥çš„æ—¶å€™ä¾ç„¶è¿˜æ˜¯è¿˜æœ‰ bugï¼Œä¸‹é¢å°±éœ€è¦æˆ‘ä»¬æ¥å®Œå–„è¿™ä¸€ä¸ªé—®é¢˜ï¼Œç”¨ä¸Šé¢å­¦ä¹ åˆ°çš„å†…å®¹

```json
{
  "presets": ["env", "stage-1", "react"],
  "plugins": [
    ["transform-runtime", { "polyfill": false }],
    "transform-decorators-legacy"
  ]
}
```

æ¯ä¸€éƒ¨åˆ†çš„ æ’ä»¶ä¹Ÿå¥½ï¼Œé¢„å¤„ç†æ–‡ä»¶ä¹Ÿå¥½ã€‚éƒ½ä¼šå½±å“ç€æ•´ä¸ªé¡¹ç›®ï¼Œå¾ˆå¤šæ—¶å€™å‡ä¸º å„ä¸ªä¸åŒç‰ˆæœ¬æ’ä»¶ä¹‹é—´çš„å…¼å®¹æ€§é—®é¢˜ï¼Œæçš„éå¸¸å¤´ç—›ï¼Œæ‰€ä»¥ï¼Œçœ‹å‡†æ’ä»¶ï¼Œä»”ç»†é˜…è¯»å…¶æ–‡æ¡£æ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚

### 2-2 ã€Vue && Babel

> Vue çš„è¯ï¼Œå› ä¸ºæœ‰ vue-cli çš„å­˜åœ¨ï¼Œå·²ç»è®² `.babelrc` æ–‡ä»¶å·²ç»ç»™ç”¨æˆ·é…ç½®å¥½äº†

```json
{
  "presets": ["es2015", "stage-2"],
  "plugins": ["transform-runtime"],
  "comments": false
}
```

## ä¸‰ã€Babel ä½¿ç”¨ æ€»ç»“

Babel çš„ä½¿ç”¨ï¼Œæ˜¯æˆ‘ä»¬å¯¹äº ES çš„å„ç§ç‰ˆæœ¬ çš„ç†è§£æ›´å¥½çš„å¸®åŠ©ï¼Œåœ¨æˆ‘ä»¬å®é™…çš„é¡¹ç›®ä½¿ç”¨ä¸­ä¹Ÿæä¾›äº† æ›´å¤šäº†å¯èƒ½ã€‚ åœ¨ç»“åˆ webpack ä½¿ç”¨çš„æ—¶å€™ï¼Œpresetsã€plugins çš„é…ç½®ã€‚tipsï¼š é…ç½®ä¸­ å„ä¸ªç‰ˆæœ¬ä¹‹é—´çš„å…¼å®¹é—®é¢˜å¾—å¼‚å¸¸æ³¨æ„ã€‚ å¥½äº†ï¼Œå…³äº babel ç›¸å…³çš„ ä»‹ç»å’Œç†è§£å°±åˆ°è¿™é‡Œï¼Œå¦‚æœè¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘ ğŸ¤”ï¼Œæ¬¢è¿æ¥æ’© ğŸ‘

---

> å…³äº Babel ä¸‹ä¸€ä»£ JavaScript è¯­æ³•ç¼–è¯‘å™¨ çš„æ–‡ç« å°±ä»‹ç»åˆ°è¿™é‡Œäº†ï¼Œæ¬¢è¿ä¸€èµ·æ¥è®ºé“ï½

> GitHub åœ°å€ï¼šï¼ˆæ¬¢è¿ star ã€æ¬¢è¿æ¨è : )
>
> [Babel ä¸‹ä¸€ä»£ JavaScript è¯­æ³•ç¼–è¯‘å™¨](https://github.com/erbing/blog/blob/master/%E5%89%8D%E7%AB%AF%E4%B9%8B%E8%B7%AF%20-%20%E7%AC%AC%E4%BA%8C%E7%AB%A0/07%EF%BC%9ABabel%20v7.0.0%20%E4%B8%8B%E4%B8%80%E4%BB%A3%20JavaScript%20%E8%AF%AD%E6%B3%95.md)

## å››ã€Babel å’Œ Prettiter ä¸ ä»£ç è§„èŒƒ

> å¦‚ä½•åœ¨ VS Code è¿™ä¸ª IDE ä¸­ç»“åˆ Babel å’Œ Prettiter è¿›è¡Œä»£ç è§„èŒƒæ‰§è¡Œ

### 3-1 ã€Prettiter

### 3-2 ã€eslint

### 3-3 ã€ç»“åˆä½¿ç”¨

## äº”ã€å®æ—¶ç¼–è¯‘ JS ä»£ç  tools
