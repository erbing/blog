# ç¬¬äºŒç«  - 03ï¼š å‰ç«¯ è¿›é˜¶æŠ€å·§ä¹‹é«˜é˜¶å‡½æ•°ï¼ˆä¸‹ï¼‰

[toc]

##ä¸€ã€é˜²ç¯¡æ”¹å¯¹è±¡

JavaScriptå…±äº«çš„æœ¬è´¨ä¸€ç›´æ˜¯å¼€å‘äººå‘˜å¿ƒå¤´çš„ç—›ï¼Œå› ä¸ºä»»ä½•å¯¹è±¡éƒ½å¯ä»¥è¢«åœ¨åŒä¸€ä¸ªç¯å¢ƒä¸­è¿è¡Œçš„ä»£ç ä¿®æ”¹ã€‚

ECMAScript5è‡´åŠ›äºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è®©å¼€å‘äººå‘˜å®šä¹‰`é˜²ç¯¡æ”¹å¯¹è±¡`ï¼ˆtamper-proof objectï¼‰ã€‚å®ƒçš„åŸç†å°±æ˜¯

é€šè¿‡è®¾ç½®æ¯ä¸ªå¯¹è±¡çš„å±æ€§çš„ä¸€ä¸‹çš„é»˜è®¤å±æ€§ï¼š

- [[Configurable]]    --- æ˜¯å¦å¯é…ç½® 
- [[Writable]]           --- æ˜¯å¦å¯ä»¥é‡æ–°èµ‹å€¼
- [[Enumerable]]     --- æ˜¯å¦å¯åˆ—ä¸¾çš„
- [[Value]]               --- é»˜è®¤å€¼
- [[Get]]  
- [[Set]]

### 1-1ï¼šConfigurable å’Œ Writable

ä¸‹é¢æˆ‘ä»¬å°±é’ˆå¯¹ä»¥ä¸Šæ¯ä¸€ä¸ªå±æ€§è¿›è¡Œ è§£æä¸€ä¸‹ï¼š

```javascript
// Demo one
var o = {}
Object.defineProperty(o, 'name', {
	value: 'zhang',
	configurable: false
})
console.log(o)

Object.defineProperty(o, 'name', {
	writable: false
})

o.name = 'Li'

console.log(o) 	// {name: 'zhange'}  å±æ€§æœªè¢«æ”¹å˜
```

ä¸Šé¢çš„ Demo ä¸­ æˆ‘ä»¬å°†  configurable å±æ€§è®¾ç½®æˆä¸º falseï¼Œ å†å¯¹æ¯”ä¸‹é¢çš„ Demo æ¥çœ‹ configurable å±æ€§ä½œç”¨

```javascript
// Demo two
var o = {}
Object.defineProperty(o, 'name', {
	value: 'zhang',
	configurable: false
})
console.log(o)

Object.defineProperty(o, 'name', {
	writable: true
})

o.name = 'Li'
 
// Uncaught TypeError: Cannot redefine property: name æŠ¥é”™

```

> æ€»ç»“ï¼š å½“ [[Configurable]] ä¸º fasle çš„æ—¶å€™ [[Writable]] é»˜è®¤å·²ç»è¢«è®¾ç½® falseï¼Œ å¦‚æœå»ä¿®æ”¹ [[Writable]] çš„æ—¶å€™
> åˆ™ä¼šæŠ¥é”™ã€‚ é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç†è§£ä¸º å½“ [[Configurable]] ä¸º false çš„æ—¶å€™ï¼Œ [[Writable]]  æ˜¯åªèƒ½ä¸º falseçš„ã€‚


### 1-2ï¼šEnumerable

æˆ‘ä»¬è¿˜æ˜¯ç”¨ Demo æ¥è¿›è¡Œå¯¹æ¯”è§£é‡Šï¼š

```javascript
var o = {}
Object.defineProperty(o, 'age', {
	enumerable: true,
	value: 18
})

for(item in o) {
	console.log(item, o[item])   // age 18
}
```

> æŠŠ enumerable è®¾ç½®æˆ false

```javascript
var o = {}
Object.defineProperty(o, 'age', {
	enumerable: false,
	value: 19
})

for(item in o) {
	console.log(item, o[item])   // undefined
}
```

### 1-3ï¼šget ã€set

get å’Œ set è¿™å¯¹åŒèƒèƒæˆ‘ä»¬å·²ç»è¯´è¿‡å¤šæ¬¡äº†ã€‚è¿™æ¬¡æˆ‘ä»¬ä»”ç»†æ¥çœ‹ä¸‹è¿™ä¸ªï½

```javascript
var o = {}
var v = 'coder'
Object.defineProperty(o, 'job', {
	get: function() {
		console.log('get:', v)
		return v
	},
	set: function(newV) {
		console.log('set:', newV)
		v = newV
	}
})
o.job = 'xxx'	// set: xxx

// å¾ˆå¥‡æ€ªçš„ä¸€ç‚¹å°±æ˜¯ å½“æˆ‘ä»¬åœ¨ æµè§ˆå™¨æ§åˆ¶å°ç‚¹å¼€ o å¯¹è±¡çš„æ—¶å€™ï¼Œå†æ¬¡å»ç‚¹å‡» job å±æ€§ï¼Œå°±ä¼šè§¦å‘ get æ–¹æ³•ã€‚
```

### 2-1ï¼šä¸å¯æ‰©å±•å¯¹è±¡

> Object.preventExtensions(o)	
å¯ä»¥ä½¿å¾— ä¸èƒ½å†ç»™å¯¹è±¡æ·»åŠ å±æ€§å’Œæ–¹æ³•

```javascript
var o = {name: 'zhang'}
Object.preventExtensions(o)

o.age = '12'
console.log(o)		// {name: 'zhang'}

// å·²ç»é˜»æ­¢äº†ç»™å¯¹è±¡æ·»åŠ å±æ€§å’Œæ–¹æ³•äº†ã€‚å†å»æ·»åŠ  ä¹Ÿæœªèƒ½æ·»åŠ ä¸Š
```

> Object.isExtensible(o)
ç¡®å®šå¯¹è±¡æ˜¯å¦å¯ä»¥æ‰©å±•

```javascript
var o = {name: 'zhang'}
var res1 = Object.isExtensible(o)
Object.preventExtensions(o)
var res2 = Object.isExtensible(o)
console.log(res1, res2)		// true false
```

### 2-2ï¼šå¯†å°çš„å¯¹è±¡

> Object.seal(o)
å¯†å°å¯¹è±¡ä¸å¯æ‰©å±•ï¼Œè€Œä¸”å·²æœ‰æˆå‘˜çš„[[Configurable]]ç‰¹æ€§è¢«è®¾ç½®ä¸ºfalseï¼Œæ„å‘³ç€ä¸èƒ½åˆ é™¤å±æ€§å’Œæ–¹æ³•ã€‚ä¸å¯å¢åŠ ï¼Œä¸èƒ½åˆ é™¤ã€‚

```javascript
var o = {name: 'Li'}
Object.isSealed(o)	// false
Object.seal(o)
Object.isSealed(o)	// true
```

>Object.isSealed(o)
æ£€æµ‹æ—¶å€™è¢«å¯†å°äº†ï¼ˆğŸ ï¼‰


### 2-3ï¼šå†»ç»“çš„å¯¹è±¡

> Object.freeze(o)

æœ€ä¸¥æ ¼çš„é˜²ç¯¡æ”¹çº§åˆ«å°±æ˜¯å†»ç»“å¯¹è±¡ï¼ˆfrozen objectï¼‰ã€‚å†»ç»“çš„å¯¹è±¡ä¸èƒ½æ‰©å±•ï¼Œåˆæ˜¯å¯†å°çš„ï¼Œè€Œä¸”å¯¹è±¡å±æ€§çš„[[Writable]]ç‰¹æ€§ä¼šè¢«è®¾ç½®ä¸ºfalseã€‚

å¦‚æœå®šä¹‰äº†[[Set]]å‡½æ•°ï¼Œè®¿é—®å™¨å±æ€§ä»ç„¶æ˜¯å¯å†™çš„ã€‚

```javascript
var obj = {age: 123}
Object.freeze(obj)
Object.isFrozen(obj)			// true
Object.isSealed(obj)			// true
Object.isExtensible(obj)		// false
```

> Object.isFrozen(o)

æ£€æŸ¥æ˜¯å¦è¢«å†»ç»“


## ä¸‰ã€è‡ªå®šä¹‰äº‹ä»¶

> åŸºäº `è§‚å¯Ÿè€…æ¨¡å¼`çš„ä¸€ç§åˆ›å»ºæ¾æ•£è€¦åˆä»£ç çš„æŠ€æœ¯ã€‚ä½¿ç”¨è‡ªå®šä¹‰äº‹ä»¶æœ‰åŠ©äºè§£è€¦ç›¸å…³å¯¹è±¡ï¼Œä¿æŒåŠŸèƒ½çš„éš”ç»ã€‚

```javascript
function EventTarget(){
    this.handlers = {};
}

EventTarget.prototype = {
    constructor : EventTraget,
    addHandler : function(type,handler){
        if(typeof this.handlers[type] === 'undefined'){
            this.handlers[type] = [];
        }
        this.handlers[type].push(handler);
    },
    fire : function(event){
        if(!event.target){
            event.target = this;
        }
        if(this.handlers[type] instanceof Array){
            var handlers = this.handlers[event.type];
            for(var i = 0,len = handlers.length; i < len; i++){
                handlers[i](event);//æ‰§è¡Œå›è°ƒå‡½æ•°
            }
        }
    },
    removeHandler : function(type,handler){
        if(this.handlers[type] instanceof Array){
            var handlers = this.handlers[type];
            for(var i = 0,len = handlers.length; i < len; i++){
                if(handlers[i] === handler){
                    break;
                }
            }
            handlers.splice(i,1);//åˆ é™¤
        }
    }
}
```

> æ€»ç»“ï¼š ä»¥ä¸Šåˆ™ä¸ºé«˜é˜¶å‡½æ•°ä¸­çš„ç›¸å…³çš„ä¸€äº›åœºæ™¯çš„åº”ç”¨ï¼Œä½†æ˜¯è¿™ä¹Ÿä»…ä»…æ˜¯å±äºåŸºç¡€éƒ¨åˆ†ï¼Œå®é™…çš„ä½¿ç”¨åœºæ™¯è¿˜éœ€è¦å¤§å®¶è‡ªå·±çµæ´»å¤„ç†ã€‚
> å¥½äº†ï¼Œæœ¬æœŸè¿™ç¯‡ blog å°±å…ˆå†™åˆ°è¿™é‡Œã€‚