# ç¬¬äºŒç«  - 04ï¼š Javascript æ¨¡å—åŒ–ç®¡ç†çš„æ¥ä¸–ä»Šç”Ÿ

[TOC]

æ¨¡å—ç®¡ç†è¿™ä¸ªæ¦‚å¿µå…¶å®åœ¨å‰å‡ å¹´å‰ç«¯åº¦è¿‡äº†åˆ€è€•ç«ç§å¹´ä»£ä¹‹åå°±ä¸€ç›´è¢«æèµ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰æ€è€ƒè¿‡è¿™ä¸ªæ¨¡å—ç®¡ç†å…·ä½“æŒ‡çš„æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿä»€ä¹ˆæ ·å­çš„å±•ç°å½¢å¼ï¼Ÿå†å²ç”±æ¥ï¼Ÿç°åœ¨æ˜¯ä»€ä¹ˆæ ·çš„ä¸€ä¸ªçŠ¶æ€ï¼Ÿ

ç›´æ¥å›æƒ³èµ·æ¥çš„å°±æ˜¯ cmd amd commonJS è¿™ä¸‰å¤§æ¨¡å—ç®¡ç†çš„å°è±¡ã€‚ä½†æ˜¯å¤§å®¶æ¸…æ¥š cmd amd commonJS ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¹ˆï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä¸€èµ·æ¥ç…ç…è¿™å…·ä½“æ˜¯å•¥æƒ…å†µã€‚

> æ„Ÿè§‰è‡ªå·±åœ¨æ¯ä¸€ä¸ªé˜¶æ®µï¼Œå¯¹äºåŒä¸€ä¸ªæŠ€æœ¯çš„ç†è§£éƒ½ä¸ä¸€æ ·ã€‚

## ä¸€ã€ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–å¼€å‘

> ä¸ºäº†è®©ä¸€æ•´ä¸ªåºå¤§çš„é¡¹ç›®çœ‹èµ·æ¥æ•´æ•´é½é½ï¼Œè§„è§„æ•´æ•´è€Œå‡ºç°çš„æ¨¡å—åŒ–ç®¡ç†ï¼Œæˆ‘ä»¬å¸¸è§çš„ä¸‰ç§æ¨¡å—åŒ–ç®¡ç†çš„åº“ï¼š requireJSã€seaJSã€commonJS è§„èŒƒ ( æ³¨æ„ï¼Œè¿™é‡Œçš„ commonJS ä¸æ˜¯ä¸€ä¸ªåº“ï¼Œè€Œæ˜¯ä¸€ç§è§„èŒƒ) é€æ¸çš„åœ¨æˆ‘ä»¬æ—¥å¸¸çš„å¼€å‘ä¸­å‡ºç°ã€‚ åŒæ—¶ä¾èµ–äº è¿™ä¸‰ç±»è§„èŒƒè€Œå‡ºç°çš„ä¸€äº›æ„å»ºå·¥å…·ï¼Œä½†æœ€åéƒ½è´¥ç»™äº† webpack ã€‚è¿™æ˜¯ä¸€ç¯‡ä»‹ç» webpack åŸºæœ¬å…¥é—¨çš„æ–‡ç« ï¼Œå¯ä»¥ç»“åˆç€è¿™ç¯‡æ–‡ç« æ¥è¿›è¡Œè§£è¯»ã€‚
> [ ã€Šå‰ç«¯ä¹‹è·¯ã€‹ä¹‹ webpack 4.0+ çš„åº”ç”¨æ„å»º ](https://www.cnblogs.com/erbingbing/p/9644898.html)

### 1-1ã€æ¨¡å—åŒ–ç¬¬ä¸€é˜¶æ®µ

> åœ¨è¿™ä¸ªé˜¶æ®µä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šæŠŠéå¸¸å¤šå¤æ‚çš„åŠŸèƒ½ å°è£…æˆä¸€ä¸ªä¸ªçš„å‡½æ•°ï¼š

```javascript
function f1() {
	// todo
}

function f2() {
	// todo
}
.
.
.
```

> ä½†æ˜¯å½“ æ•´ä¸ªé¡¹ç›®å˜å¤§äº†ä»¥åï¼Œå°±ä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ï¼Œéƒ½æ˜¯å®šä¹‰çš„å…¨å±€å˜é‡ï¼Œå½¢æˆäº†æ¯”è¾ƒä¸¥é‡çš„æ±¡æŸ“ï¼Œè¿˜æœ‰å¯èƒ½ä¼šå‡ºç°å› ä¸ºé‡å‘½åå¯¼è‡´çš„å„ç§é—®é¢˜ã€‚æ‰€ä»¥è¿™äº›æ˜¯éœ€è¦è¿›åŒ–çš„ã€‚æ‰€ä»¥å°±ä¼šè¿›å…¥åˆ°æ¨¡å—åŒ–çš„ç¬¬äºŒé˜¶æ®µï¼š å¯¹è±¡ã€‚

### 1-2ã€å°è£…åˆ°å¯¹è±¡

> åˆ°äº†ç¬¬äºŒä¸ªé˜¶æ®µä¸ºäº†é¿å…å…¨å±€å˜é‡çš„æ±¡æŸ“ï¼Œæˆ‘ä»¬ä¼šå°†å•ä¸ªæ¨¡å—å°è£…åˆ°ä¸€ä¸ªå¯¹è±¡å†…éƒ¨ã€‚å¦‚ä¸‹ï¼š

```javascript
const module = {
	let _number = 10,
	f1: () => {
		console.log(123)
	},
	f2: () => {
		console.log(456)
	},
	.
	.
	.
}
```

> è¿™æ ·æˆ‘ä»¬å°±æ²¡ä¸ªæ¨¡å—å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨éœ€è¦çš„æ—¶å€™ç›´æ¥è°ƒç”¨å°±å¥½äº†ï¼Œä½†æ˜¯è¿™æ ·ä¹Ÿä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜
> è¿™æ ·å†™çš„è¯ä¼šæš´éœ²å…¨éƒ¨çš„å¯¹è±¡å†…éƒ¨çš„å±æ€§ï¼Œ`å†…éƒ¨çŠ¶æ€å¯ä»¥è¢«å¤–éƒ¨æ”¹å˜`. ä¾‹å¦‚ï¼š

```javascript
module._number = 100;
```

> å¦‚æœæˆ‘ä»¬æ”¯ä»˜ç›¸å…³æ¨¡å—è¿™æ ·å­æ¥å†™çš„è¯ã€‚æˆ‘ä»¬éšæ„çš„æ¥æ”¹å˜æ”¯ä»˜çš„é‡‘é¢ï¼Œé‚£æ ·å°±ä¼šå‡ºç°æ¯”è¾ƒå±é™©çš„æƒ…å†µã€‚

### 1-3ã€ å¯¹è±¡çš„ä¼˜åŒ–

> åæ¥ï¼Œèªæ˜çš„äººç±»å°±æƒ³åˆ°äº†åˆ©ç”¨ ç«‹å³æ‰§è¡Œå‡½æ•° æ¥è¾¾åˆ° ä¸æš´éœ²ç§æœ‰æˆå‘˜çš„ç›®çš„

```javascript
const module2 = (function() {
  let _money = 100;
  const m1 = () => {
    console.log(123);
  };
  const m2 = () => {
    console.log(456);
  };
  return {
    f1: m1,
    f2: m2
  };
})();
```

é€šè¿‡ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œè®©å¤–éƒ¨æ ¹æœ¬æ²¡æœ‰æ—¶é—´ä»å¤–éƒ¨å»ä¿®æ”¹å†…éƒ¨çš„å±æ€§ï¼Œä»è€Œè¾¾åˆ°ä¸€å®šçš„é˜²å¾¡ä½œç”¨ã€‚

> ä»¥ä¸Šå°±æ˜¯æ¨¡å—åŒ–å¼€å‘çš„åŸºç¡€ä¸­çš„åŸºç¡€ã€‚ æ²¡æœ‰åº“ï¼Œæ²¡æœ‰è§„èŒƒï¼Œä¸€åˆ‡çš„ç»´æŠ¤éƒ½æ˜¯é äººåŠ›ï¼Œä¸€åˆ‡çš„åˆ›æ–°ï¼Œéƒ½æ˜¯æ¥æºäº è§£æ”¾ç”Ÿäº§åŠ›ã€‚

## äºŒã€æ¨¡å—åŒ–ç®¡ç†çš„å‘å±•å†ç¨‹

### 2-1ã€CommonJS

> CommonJS çš„å‡ºå‘ç‚¹ï¼š JS æ²¡æœ‰å®Œå–„çš„æ¨¡å—ç³»ç»Ÿï¼Œæ ‡å‡†åº“è¾ƒå°‘ï¼Œç¼ºå°‘åŒ…ç®¡ç†å·¥å…·ã€‚ï¼ˆè™½ç„¶è¿™äº›ä¸œè¥¿ï¼Œåœ¨åç«¯è¯­è¨€ä¸­å·²ç»æ˜¯ æ—©å°±è¢«ç©çš„ä¸æƒ³ç©çš„ä¸œè¥¿äº†ï¼‰
> ä¼´éšç€ NodeJS çš„å…´èµ·ï¼Œèƒ½è®© JS å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œï¼Œç‰¹åˆ«æ˜¯æœåŠ¡ç«¯ï¼Œä»¥è¾¾åˆ° ä¹Ÿå…·å¤‡ Javaã€C#ã€PHP è¿™äº›åå°è¯­è¨€å…·å¤‡å¼€å‘å¤§å‹åº”ç”¨çš„èƒ½åŠ›ï¼Œæ‰€ä»¥ CommonJS åº”è¿è€Œç”Ÿã€‚

#### 2-1-1ã€ CommonJS å¸¸è§è§„èŒƒ

- ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæ‹¥æœ‰å•ç‹¬çš„ä½œç”¨åŸŸ
- æ™®é€šæ–¹å¼å®šä¹‰çš„ å˜é‡ã€å‡½æ•°ã€å¯¹è±¡éƒ½å±äºè¯¥æ¨¡å—å†…
- é€šè¿‡ `require` æ¥å®¶åœ¨æ¨¡å—
- é€šè¿‡ `exports` å’Œ `module.exports` æ¥æš´éœ²æ¨¡å—ä¸­çš„å†…å®¹

æˆ‘ä»¬é€šè¿‡ç¼–å†™ä¸€ä¸ª Demo æ¥å°è¯•å†™è¿™ä¸ªè§„èŒƒ

> Demo 1 : é€šè¿‡ module.exports æ¥å¯¼å‡ºæ¨¡å—

```javascript
// module.js
module.exports = {
  name: "zhang",
  getName: function() {
    console.log(this.name);
  },
  changeName: function(n) {
    this.name = n;
  }
};

// index.js
const module = require("./module/index");
console.log(module); //  {name: "zhang", getName: Æ’, changeName: Æ’} "commons"
```

> Demo 2 : é€šè¿‡ exports æ¥å¯¼å‡ºæ¨¡å—

```javascript
// module1.js
const getParam = () => {
  console.log(a);
};
let a = 123;
let b = 456;

exports.a = a;
exports.b = b;
exports.getParam = getParam;

// index.js
const module1 = require("./module/index1");
consoel.log(module1, "commons1"); // {a: 123, b: 456, getParam: Æ’} "commons1"
```

> Demo 3 : åŒæ—¶å­˜åœ¨ exports å’Œ module.exports æ¥å¯¼å‡ºæ¨¡å—

```javascript
// module2.js
let a = 123;

const getSome = () => {
  console.log("yyy");
};

const getA = () => {
  console.log(a);
};

exports.getSome = getSome;
module.exports = getA;

// index.js
const module2 = require("./module/index2");
consoel.log(module2, "commons2"); // function getA() {...}
```

> æ€»ç»“ ï¼š é€šè¿‡è¿™æ ·çš„ä¸€ä¸ªå¯¹æ¯”çš„ä¾‹å­å°±å¯ä»¥æ¯”è¾ƒæ¸…æ™°çš„å¯¹æ¯”å‡º exports å’Œ module.exports çš„åŒºåˆ«:
> 1ã€å½“ exports å’Œ module.exports åŒæ—¶å­˜åœ¨çš„æ—¶å€™ï¼Œmodule.exports ä¼šç›–è¿‡ exports
> 2ã€å½“æ¨¡å—å†…éƒ¨å…¨éƒ¨æ˜¯ exports çš„æ—¶å€™ï¼Œ å°±ç­‰åŒäº module.exports
> 3ã€æœ€å æˆ‘ä»¬å°±å¯ä»¥è®¤å®šä¸º exports å…¶å®å°±æ˜¯ module.exports çš„å­é›†ã€‚

ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬å¯¹äº CommonJS çš„ä¸€ä¸ªåˆçº§çš„ä»‹ç»ã€‚
è¿˜æœ‰ä¸€ä¸ªç¡¬æ€§çš„è§„èŒƒï¼Œè¿™é‡Œæˆ‘ä»¬åªæ˜¯åšä¸€ä¸‹åˆ—ä¸¾ï¼Œå°±ä¸åšè¯¦ç»†çš„ Demo æ¼”ç¤ºäº†ã€‚

#### 2-1-2ã€ CommonJS è§„èŒƒ --- åŠ è½½ã€ä½œç”¨åŸŸ

> æ‰€æœ‰ä»£ç éƒ½è¿è¡Œåœ¨æ¨¡å—ä½œç”¨åŸŸï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸï¼›æ¨¡å—å¯ä»¥å¤šæ¬¡åŠ è½½ï¼Œä½†åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½çš„æ—¶å€™è¿è¡Œä¸€æ¬¡ï¼Œç„¶åè¿è¡Œç»“æœå°±è¢«ç¼“å­˜äº†ï¼Œä»¥åå†åŠ è½½ï¼Œå°±ç›´æ¥è¯»å–ç¼“å­˜ç»“æœï¼›æ¨¡å—çš„åŠ è½½é¡ºåºï¼ŒæŒ‰ç…§ä»£ç çš„å‡ºç°é¡ºåºæ˜¯åŒæ­¥åŠ è½½çš„;

#### 2-1-3ã€ CommonJS è§„èŒƒ --- **dirnameã€**filename

> **dirname ä»£è¡¨å½“å‰æ¨¡å—æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œ**filename ä»£è¡¨å½“å‰æ¨¡å—æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹è·¯å¾„+æ–‡ä»¶å;

ä»¥ä¸Šå°±æ˜¯å…³äº CommonJS è§„èŒƒ ç›¸å…³çš„ä»‹ç»ï¼Œæ›´ä¸‹è¯¦ç»†çš„ æ–‡æ¡£ï¼Œå¯ä»¥æŸ¥é˜… CommonJS è§„èŒƒ å®˜æ–¹æ–‡æ¡£ã€‚

### 2-2ã€CommonJS ä¸ ES6ï¼ˆES2015ï¼‰ çš„ import export

> åœ¨ ES2015 æ ‡å‡†ä¸ºå‡ºæ¥ä¹‹å‰ï¼Œæœ€ä¸»è¦çš„æ˜¯ CommonJS å’Œ AMD è§„èŒƒã€‚ä¸Šæ–‡ä¸­æˆ‘ä»¬å·²ç»ä»‹ç»äº† CommonJS è§„èŒƒï¼ˆä¸»è¦æ˜¯ä¸ºäº†æœåŠ¡ç«¯ NodeJS æœåŠ¡ï¼‰ï¼Œé‚£ä¹ˆå½“ ES6 æ ‡å‡†çš„å‡ºç°ï¼Œä¸ºæµè§ˆå™¨ç«¯ æ¨¡å—åŒ–åšäº†ä¸€ä¸ªéå¸¸å¥½çš„è¡¥å……ã€‚

è¿™é‡Œï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»ä¸‹ ES6 çš„ import export çš„ç³»åˆ—ç‰¹æ€§ã€‚

### 2-2-1ã€ ES6 çš„ export

> export ç”¨äºå¯¹å¤–è¾“å‡ºæœ¬æ¨¡å—ï¼ˆä¸€ä¸ªæ–‡ä»¶å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ¨¡å—ï¼‰å˜é‡çš„æ¥å£

> Demo 1 export { xxx }

```javascript
// export/index.js
const a = "123";
const fn = () => window.location.href;

export { fn };

// show/index.js
const ex = require("./export/index");
import x from "./export/index";
import { fn } from "./export/index";
console.log(ex, "export1"); // {fn: Æ’, __esModule: true} "export1"
console.log(x, "export-x"); // undefined "export-x"
console.log(fn, "export-fn"); // function() { return window.location.href; } "export-x"
```

> Demo 2 export default xxx

```javascript
// export/index1.js
const a = "123";
const fn = () => window.location.href;
export default fn;

// show/index1.js
const ex1 = require("./export/index1");
import x from "./export/index1";

console.log(ex1, "export1");
// {default: Æ’, __esModule: true} "export1"
console.log(x, "export2");
// Æ’ fn() {return window.location.href;} "export2"
```

> é€šè¿‡ Demo 1 å’Œ Demo 2 æˆ‘ä»¬å¯ä»¥å¾ˆå¥½çš„ å¯¹æ¯”äº†ä¸‹ export å’Œ export default çš„åŒºåˆ«

`export` å¯ä»¥å¯¼å‡ºçš„æ˜¯ä¸€ä¸ªå¯¹è±¡ä¸­åŒ…å«çš„å¤šä¸ª å±æ€§ï¼Œæ–¹æ³•ã€‚
`export default` åªèƒ½å¯¼å‡º ä¸€ä¸ª å¯ä»¥ä¸å…·åçš„ å¯¹è±¡ã€‚

`import {fn} from './xxx/xxx'` ( export å¯¼å‡ºæ–¹å¼çš„ å¼•ç”¨æ–¹å¼ )
`import fn from './xxx/xxx1'` ( export default å¯¼å‡ºæ–¹å¼çš„ å¼•ç”¨æ–¹å¼ )

> åŒæ—¶ï¼Œæˆ‘ä»¬å‘ç° å¯ä»¥ç›´æ¥ä½¿ç”¨ require æ¥å¼•ç”¨

è¿™ä¸ªä¹Ÿèƒ½å¼•ç”¨å…¶å®æœ‰ç‚¹ç¥å¥‡çš„ã€‚ä½†æ˜¯åŠŸèƒ½å’Œ import ä¸€æ ·ã€‚ï¼ˆåŸå› å°±æ˜¯æˆ‘è¿™é‡Œèµ·äº† webpack çš„ server ç›¸å…³ï¼‰

### 2-2-2ã€ ES6 çš„ import

è¿™é‡Œå°±åŒä¸Šé¢ Demo ä¸­çš„ä¾‹å­ä¸€æ ·äº†å¾—å‡ºçš„ç»“è®ºå°±æ˜¯

`import {fn} from './xxx/xxx'` ( export å¯¼å‡ºæ–¹å¼çš„ å¼•ç”¨æ–¹å¼ )
`import fn from './xxx/xxx1'` ( export default å¯¼å‡ºæ–¹å¼çš„ å¼•ç”¨æ–¹å¼ ï¼Œå¯ä»¥ä¸ç”¨åœ¨æ„å¯¼å‡ºæ¨¡å—çš„æ¨¡å—å)

> æ€»ç»“ï¼š ä¹‹å‰å¯¹äº æ¨¡å—çš„å¯¼å‡ºã€å¼•ç”¨ çš„æ¦‚å¿µéƒ½æ¯”è¾ƒçš„é­”å¹»ï¼Œè¿™æ¬¡é€šè¿‡çŸ¥è¯†çš„æ¢³ç†ç»ˆäºææ¸…æ¥šäº†ã€‚ğŸ˜„

> Demo ä¾‹å­ä¼ é€é—¨ï¼š [æ¨¡å—åŒ–ã€‹ã€‹ã€‹](https://github.com/erbing/BaseWebpackV4)

### 2-3ã€AMD çš„ RequireJS

> Asynchronous Module Definitionï¼Œä¸­æ–‡åæ˜¯å¼‚æ­¥æ¨¡å—ã€‚å®ƒæ˜¯ä¸€ä¸ªåœ¨æµè§ˆå™¨ç«¯æ¨¡å—åŒ–å¼€å‘çš„è§„èŒƒï¼Œç”±äºä¸æ˜¯ js åŸç”Ÿæ”¯æŒï¼Œä½¿ç”¨ AMD è§„èŒƒè¿›è¡Œé¡µé¢å¼€å‘éœ€è¦ç”¨åˆ°å¯¹åº”çš„å‡½æ•°åº“ï¼Œä¹Ÿå°±æ˜¯å¤§åé¼é¼çš„ RequireJSï¼Œå®é™…ä¸Š AMD æ˜¯ RequireJS åœ¨æ¨å¹¿è¿‡ç¨‹ä¸­å¯¹æ¨¡å—å®šä¹‰çš„è§„èŒƒåŒ–çš„äº§å‡ºã€‚

---

> requireJS ä¸»è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š

- 1ã€ å¤šä¸ª js æ–‡ä»¶å¯èƒ½æœ‰ä¾èµ–å…³ç³»ï¼Œè¢«ä¾èµ–çš„æ–‡ä»¶éœ€è¦æ—©äºä¾èµ–å®ƒçš„æ–‡ä»¶åŠ è½½åˆ°æµè§ˆå™¨ã€‚
- 2ã€ js åŠ è½½çš„æ—¶å€™æµè§ˆå™¨ä¼šåœæ­¢é¡µé¢æ¸²æŸ“ï¼ŒåŠ è½½æ–‡ä»¶æ„ˆå¤šï¼Œé¡µé¢å¤±å»å“åº”çš„æ—¶é—´æ„ˆé•¿ã€‚
- 3ã€ åæ¥æ”¹è¿›ä¸º è¢«ä¾èµ–çš„æ–‡ä»¶ï¼Œå¯ä»¥åœ¨éœ€è¦è¢«åŠ è½½çš„æ—¶å€™ï¼Œå¼‚æ­¥è¿›è¡ŒåŠ è½½ä»è€ŒåŠ å¿«é¦–é¡µåŠ è½½

æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª Demo æ¥ä»‹ç»ä¸‹ RequireJS çš„è¯­æ³•ï¼š

```javascript
// å®šä¹‰æ¨¡å—
define(["dependency"], () => {
  var name = "Byron";
  function printName() {
    console.log(name);
  }
  return {
    printName: printName
  };
});

// åŠ è½½æ¨¡å—
require(["myModule"], function(my) {
  my.printName();
});
```

å®ç°åŸç†ï¼š


### 2-4ã€CMD çš„ SaeJS

## ä¸‰ã€æ¨¡å—åŒ–æ¡†æ¶åŸç†

## å››ã€å¦‚ä½•å¼€é¡¹ç›®å¼€å‘ä¸­åˆç†ä½¿ç”¨æ¨¡å—åŒ– s
